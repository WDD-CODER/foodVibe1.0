<div class="search-container" dir="rtl" (clickOutside)="showResults_.set(false)">
  <div class="input-wrapper">
    <lucide-icon name="search" size="18"></lucide-icon>
    <input
      #searchInput
      type="text"
      [value]="searchQuery_()"
      (input)="searchQuery_.set($any($event.target).value); showResults_.set(true)"
      (focus)="showResults_.set(true)"
      placeholder="{{ 'search_preparation' | translatePipe }}" />
  </div>

  @if (showResults_() && groupedResults_().length > 0) {
    <ul class="results-dropdown">
      @for (group of groupedResults_(); track group[0]) {
        <li class="category-header">{{ group[0] }}</li>
        @for (entry of group[1]; track entry.name + entry.category) {
          <li (click)="selectPreparation(entry)" class="result-item">
            <span class="item-name">{{ entry.name }}</span>
            <span class="category-pill">{{ entry.category }}</span>
          </li>
        }
      }
    </ul>
  }

  @if (showResults_() && showAddOption_()) {
    <div class="add-option">
      <button type="button" (click)="addPreparationDirectly()" class="add-prep-btn">
        <lucide-icon name="plus" size="16"></lucide-icon>
        {{ 'add_preparation' | translatePipe }}: {{ searchQuery_() }}
      </button>
    </div>
  }
</div>
