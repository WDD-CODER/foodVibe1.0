<div class="metadata-page" dir="rtl">
  <header class="header-section">
    <h1>ניהול הגדרות ליבה (The Brain)</h1>
    <p>שליטה גלובלית על יחידות מידה, אלרגנים וקטגוריות מוצרים</p>
  </header>

  <div class="admin-grid">
    <ng-container *ngTemplateOutlet="managerCard; context: { 
      title: 'יחידות והמרות', 
      icon: 'scale', 
      colorClass: 'text-emerald-600',
      items: allUnitKeys_(),
      type: 'unit'
    }"></ng-container>

    <ng-container *ngTemplateOutlet="managerCard; context: { 
      title: 'קטגוריות מוצרים', 
      icon: 'tag', 
      colorClass: 'text-indigo-600',
      items: allCategories_(),
      type: 'category'
    }"></ng-container>

    <ng-container *ngTemplateOutlet="managerCard; context: { 
      title: 'מאגר אלרגנים גלובלי', 
      icon: 'alert-triangle', 
      colorClass: 'text-rose-500',
      items: allAllergens_(),
      type: 'allergen'
    }"></ng-container>
  </div>
</div>

<ng-template #managerCard let-title="title" let-icon="icon" let-colorClass="colorClass" let-items="items"
  let-type="type">
  <section class="manager-card">
    <div class="card-title">
      <lucide-icon [name]="icon" [class]="colorClass"></lucide-icon>
      <h2>{{ title }}</h2>
    </div>

    <div class="input-group">
      <input #newInput type="text" [placeholder]="'הוסף ' + title + '...'"
        (keyup.enter)="onAddMetadata(newInput.value, type, newInput)">

      <button (click)="onAddMetadata(newInput.value, type, newInput)" class="btn-add">
        הוסף
      </button>
    </div>

    <div class="list-container">
      @if (items.length > 0) {
      <div [class]="type === 'allergen' ? 'allergen-pool' : 'list-stack'">
        @for (item of items; track item) {
        <div [class]="type === 'allergen' ? 'allergen-pill' : 'list-item group'">
          <span>{{ item | translatePipe }}</span>

          @if (type === 'unit') {
          <input type="number" [value]="tempUnitRates()[item]" (change)="updateUnitRate(item, $event)
          ">
          }

          <button class="btn-delete" (click)="onRemoveMetadata(item, type)">
            <lucide-icon [name]="type === 'allergen' ? 'x' : 'trash-2'"
              [size]="type === 'allergen' ? 14 : 16"></lucide-icon>
          </button>
        </div>
        }
      </div>
      } @else {
      <div class="empty-state">אין {{ title }} רשומים במערכת</div>
      }
    </div>
  </section>
</ng-template>